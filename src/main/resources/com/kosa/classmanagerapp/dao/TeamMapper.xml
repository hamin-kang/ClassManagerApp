<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kosa.classmanagerapp.dao.TeamMapper">
    <insert id="save" parameterType="Team">
        INSERT INTO team (team_name, project_id)
        VALUES (#{teamName}, #{projectId})
    </insert>

    <select id="count" resultType="int">
        SELECT COUNT(*) FROM team
    </select>

    <select id="findByUserName" resultType="User">
        SELECT * FROM user WHERE user_name = #{userName}
    </select>


    <!--  user 테이블 조회 → team 만들 때 사용자 목록 가져오기 -->
    <select id="findAllUser" resultType="User">
        SELECT id, user_name AS userName, full_name AS fullName, team_id AS teamId
        FROM user;
    </select>

    <!-- 팀 이름으로 존재 여부 확인 -->
    <select id="countByTeamName" parameterType="String" resultType="int">
        SELECT COUNT(*)
        FROM team
        WHERE team_name = #{teamName}
    </select>

    <!-- 팀 멤버 정보 업데이트 -->
    <update id="updateTeamMember" parameterType="Team">
        UPDATE team
        SET team_name = #{teamName},
        project_id = 1,
        created_at = NOW()
        WHERE id = #{id}
    </update>


    <!-- 팀 존재 여부 체크   -->
    <select id="existsTeam" parameterType="int" resultType="int">
        SELECT COUNT(*)
        FROM team
        WHERE id = #{id}
    </select>

<!--  team테이블에 팀id가 없으면 insert  -->

    <insert id="insertTeamMember" parameterType="Team" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO team (team_name, project_id, created_at)
        VALUES (#{teamName}, 1, NOW())
    </insert>

</mapper>